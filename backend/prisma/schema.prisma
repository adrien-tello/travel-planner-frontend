// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User Management
model User {
  id          String   @id @default(cuid())
  name      String
  email       String   @unique
  password    String
  firstName   String?
  lastName    String?
  avatar      String?
  isOnboarded Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  itineraries Itinerary[]
  favorites   UserFavorite[]
  reviews     Review[]
  preferences UserPreferences?
  trips       Trip[]

  @@map("users")
}

// User Trips
model Trip {
  id          String   @id @default(cuid())
  userId      String
  destination String
  startDate   String
  endDate     String
  budget      String
  itinerary   String?  // JSON string of detailed itinerary
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("trips")
}

// User Preferences from Onboarding
model UserPreferences {
  id              String   @id @default(cuid())
  userId          String   @unique
  travelStyle     String   // relaxed, moderate, packed
  budgetRange     String   // low, mid, high
  interests       String[] // culture, food, adventure, etc.
  groupSize       Int      @default(1)
  travelWithKids  Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

// Destinations
model Destination {
  id          String  @id @default(cuid())
  name        String
  country     String
  city        String?
  latitude    Float
  longitude   Float
  description String?
  imageUrl    String?
  currency    String?
  timezone    String?
  bestTime    String? // Best time to visit
  avgBudget   Json?   // Budget ranges
  tags        String[] // beach, culture, adventure, etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  itineraries Itinerary[]
  places      Place[]
  favorites   UserFavorite[]
  reviews     Review[]

  @@map("destinations")
}

// Places (Hotels, Restaurants, Attractions)
model Place {
  id            String    @id @default(cuid())
  name          String
  type          PlaceType // HOTEL, RESTAURANT, ATTRACTION, ACTIVITY
  destinationId String
  address       String?
  latitude      Float?
  longitude     Float?
  description   String?
  imageUrl      String?
  rating        Float?
  priceRange    String?   // $, $$, $$$, $$$$
  website       String?
  phone         String?
  openingHours  Json?
  amenities     String[]
  tags          String[]
  externalId    String?   // Tripadvisor location_id
  source        String?   // "TRIPADVISOR", "MANUAL", etc.
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  destination      Destination        @relation(fields: [destinationId], references: [id], onDelete: Cascade)
  itineraryPlaces  ItineraryPlace[]
  reviews          Review[]

  @@unique([externalId, source])
  @@map("places")
}

// AI-Generated Itineraries
model Itinerary {
  id            String          @id @default(cuid())
  userId        String
  destinationId String
  title         String
  description   String?
  startDate     DateTime
  endDate       DateTime
  budget        Float @default(5000)
  budgetRange   String?         // LOW, MID, HIGH
  travelers     Int             @default(1)
  travelStyle   String?         // RELAXED, MODERATE, PACKED
  interests     String[]        // culture, food, adventure, etc.
  status        ItineraryStatus @default(DRAFT)
  aiGenerated   Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  // Relations
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination Destination      @relation(fields: [destinationId], references: [id])
  days        ItineraryDay[]
  places      ItineraryPlace[]

  @@map("itineraries")
}

// Daily itinerary structure
model ItineraryDay {
  id          String   @id @default(cuid())
  itineraryId String
  dayNumber   Int
  date        DateTime
  title       String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  itinerary Itinerary        @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
  places    ItineraryPlace[]

  @@unique([itineraryId, dayNumber])
  @@map("itinerary_days")
}

// Places within itineraries
model ItineraryPlace {
  id            String   @id @default(cuid())
  itineraryId   String
  dayId         String?
  placeId       String
  order         Int      // Order within the day
  startTime     String?  // "09:00"
  endTime       String?
  duration      Int?     // minutes
  notes         String?
  isOptional    Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  itinerary Itinerary     @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
  day       ItineraryDay? @relation(fields: [dayId], references: [id], onDelete: Cascade)
  place     Place         @relation(fields: [placeId], references: [id])

  @@map("itinerary_places")
}

// User favorites
model UserFavorite {
  id            String   @id @default(cuid())
  userId        String
  destinationId String
  createdAt     DateTime @default(now())

  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([userId, destinationId])
  @@map("user_favorites")
}

// Reviews and ratings
model Review {
  id            String   @id @default(cuid())
  userId        String
  destinationId String?
  placeId       String?
  rating        Int      // 1-5
  title         String?
  content       String?
  images        String[]
  helpful       Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination Destination? @relation(fields: [destinationId], references: [id], onDelete: Cascade)
  place       Place?       @relation(fields: [placeId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

// Enums
enum PlaceType {
  HOTEL
  RESTAURANT
  ATTRACTION
  ACTIVITY
  TRANSPORT
  SHOPPING
}

enum ItineraryStatus {
  DRAFT
  ACTIVE
  COMPLETED
  ARCHIVED
}
